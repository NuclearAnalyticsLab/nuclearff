<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Setup a Play-by-Play Database with nflfastR • nuclearff</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Setup a Play-by-Play Database with nflfastR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nuclearff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/NuclearAnalyticsLab/nuclearff"><span class="fa fa-brands fa-github"></span> </a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://x.com/nuclearffnolan"><span class="fa fa-brands fa-x-twitter"></span> </a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Setup a Play-by-Play Database with nflfastR</h1>
                        <h4 data-toc-skip class="author">Nolan
MacDonald</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NuclearAnalyticsLab/nuclearff/blob/HEAD/vignettes/setup_pbp_db.Rmd"><code>vignettes/setup_pbp_db.Rmd</code></a></small>
      <div class="d-none name"><code>setup_pbp_db.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="install-packages">Install Packages<a class="anchor" aria-label="anchor" href="#install-packages"></a>
</h2>
<p>Data from <code>nflfastR</code> can be stored in a database to access
locally instead of pulling play-by-play information each time. The
database takes up a significant amount of memory, as it stores data
dating back to the 1999 season. Working with the database is beneficial
as is allows you to only bring into memory the data you actually need.
Using R, it is relatively easy to work with databases as long as you are
comfortable with <code>dplyr</code> functions to manipulate and tidy
data.</p>
<p>To use the database, the <code>DBI</code> and <code>RSQLite</code>
packages should be installed. To install these required packages, use
the following commands in the R console:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">install.packages</span><span class="er">(</span><span class="st">"DBI"</span><span class="kw">)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">install.packages</span><span class="er">(</span><span class="st">"RSQLite"</span><span class="kw">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="play-by-play-database">Play-By-Play Database<a class="anchor" aria-label="anchor" href="#play-by-play-database"></a>
</h2>
<p>Now that the packages have been installed, the database can be built.
<code>nflfastR</code> uses the function <code><a href="https://www.nflfastr.com/reference/update_db.html" class="external-link">update_db()</a></code> to work
with databases. Using <code><a href="https://www.nflfastr.com/reference/update_db.html" class="external-link">update_db()</a></code> with no arguments will
build a database with default arguments, where the SQLite database will
be stored as <code>pbp_db</code> that contains all of the play-by-play
data in a table called <code>nflfastR_pbp</code>. To store the database
in a specified directory, use the argument <code>dbdir</code>. To
specify the file name use <code>dbname</code> and to change the table
name use <code>tblname</code>.</p>
<p>If there is already an existing database and you want to rebuild it
from scratch, use the argument <code>force_rebuild=TRUE</code>. This is
typically performed when there is an update to play-by-play data from
fixing a bug or you want to wipe the database and update it. If you want
to rebuild only specific seasons, you can use the command
<code>force_rebuild=2023</code> or for multiple seasons,
<code>force_rebuild=c(2022, 2023)</code>.</p>
<p><strong>Summary of Database and Arguments:</strong></p>
<ul>
<li>
<code><a href="https://www.nflfastr.com/reference/update_db.html" class="external-link">update_db()</a></code>: Build or update play-by-play database
<ul>
<li>
<code>update_db(dbdir = "path/to/save/db")</code>: Build
play-by-play database and save to path</li>
<li>
<code>update_db(dbname="db_name")</code>: Build play-by-play
database with custom name (Default: <code>nflfastR_pbp</code>)</li>
<li>
<code>update_db(tblname="tblname")</code>: Build play-by-play
database with custom table name (Default:
<code>nflfastR_pbp</code>)</li>
<li>
<code>update_db(force_rebuild=TRUE)</code>: Rebuild entire
play-by-play database</li>
<li><ul>
<li>
<code>update_db(force_rebuild=c(2022, 2023))</code>: Rebuild
play-by-play database 2022-2023 seasons</li>
</ul></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="create-database">Create Database<a class="anchor" aria-label="anchor" href="#create-database"></a>
</h2>
<p>To first create and dump a database you need to load the libraries
that were recently installed. After loading the libraries,
<code><a href="https://www.nflfastr.com/reference/update_db.html" class="external-link">update_db()</a></code> is utilized to create or update the database.
In this example, the database is saved in the repository’s directory,
<code>data/pbp_db</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create or update the database</span></span>
<span><span class="fu">nflfastR</span><span class="fu">::</span><span class="fu"><a href="https://www.nflfastr.com/reference/update_db.html" class="external-link">update_db</a></span><span class="op">(</span>dbdir <span class="op">=</span> <span class="st">"data/pbp_db"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-database">Load Database<a class="anchor" aria-label="anchor" href="#load-database"></a>
</h2>
<p>The database is <code>pbp_db</code> loaded from the directory
<code>data/pbp_db</code>. Once connected to the database with
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect()</a></code>, the tables stored in the database are obtained
with <code>dbListTables</code>. There should only be one table with the
newly constructed database, <code>nflfastR_pbp</code>, as previously
discussed since the default naming schemes were used.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to database</span></span>
<span><span class="va">connect</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"./data/pbp_db/pbp_db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List tables</span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">connect</span><span class="op">)</span></span>
<span><span class="co"># Close the database when finished</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">connect</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span></span>
<span><span class="co">#&gt; [1] "nflfastR_pbp"</span></span></code></pre></div>
<p>Another option is to look at the fields (columns) that are stored in
the table. Use <code><a href="https://dbi.r-dbi.org/reference/dbListFields.html" class="external-link">dbListFields()</a></code> to show the data available in
the table. For the example below, the fields are saved in a list and
<code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> is used to show only the first 10 fields since there
is a large amount of data (372 fields!).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to database</span></span>
<span><span class="va">connect</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"./data/pbp_db/pbp_db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List fields</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListFields.html" class="external-link">dbListFields</a></span><span class="op">(</span><span class="va">connect</span>, <span class="st">"nflfastR_pbp"</span><span class="op">)</span></span>
<span><span class="co"># Close the database when finished</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">connect</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fields</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "play_id"      "game_id"      "old_game_id"  "home_team"    "away_team"   </span></span>
<span><span class="co">#&gt;  [6] "season_type"  "week"         "posteam"      "posteam_type" "defteam"</span></span></code></pre></div>
<p>Finally, the play-by-play table is loaded from the database with
<code><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">dplyr::tbl()</a></code>. Use the play-by-play information to write
code and conduct the analysis, and make sure to disconnect the database
when you are finished.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to database</span></span>
<span><span class="va">connect</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"./data/pbp_db/pbp_db"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load pbp_db</span></span>
<span><span class="va">pbp_db</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">connect</span>, <span class="st">"nflfastR_pbp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Additional code here...</span></span>
<span></span>
<span><span class="co"># Close the database when finished</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">connect</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calling-functions-with-database">Calling Functions with Database<a class="anchor" aria-label="anchor" href="#calling-functions-with-database"></a>
</h2>
<p>Now that a database has been created and saved,
<code>nuclearff</code> functions can be utilized. For example, try
obtaining advanced RB stats for a season but using the function
<code><a href="../reference/get_rb_adv_stats_season.html">get_rb_adv_stats_season()</a></code>. The default arguments is to look
for a play-by-play database stored in <code>data/pbp_db</code> named
<code>pbp_db</code> with a table called <code>nflfastR_pbp</code>. If
the user database is saved elsewhere or with different names, then
define the argument with a string. After loading the required packages,
the function can be called.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.nflfastr.com/" class="external-link">nflfastR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NuclearAnalyticsLab/nuclearff">nuclearff</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rb_adv_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_rb_adv_stats_season.html">get_rb_adv_stats_season</a></span><span class="op">(</span>pbp_db <span class="op">=</span> <span class="st">"./data/pbp_db/pbp_db"</span>,</span>
<span>                                        pbp_db_tbl <span class="op">=</span> <span class="st">"nflfastR_pbp"</span>,</span>
<span>                                        season <span class="op">=</span> <span class="fl">2024</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-information">Additional Information<a class="anchor" aria-label="anchor" href="#additional-information"></a>
</h2>
<p>To determine if any data from <code>nflverse</code> has been updated,
check the <a href="https://nflreadr.nflverse.com/articles/nflverse_data_schedule.html" class="external-link">nflverse
Data Update and Availability Schedule</a>.</p>
<p>For more information, refer to the <code>nflfastR</code> package
<span class="citation">[1]</span> or the <a href="https://www.nflfastr.com" class="external-link">nflfastR documentation</a>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body" entry-spacing="0">
<div id="ref-nflfastR" class="csl-entry">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">S.
Carl and B. Baldwin, <em><a href="https://www.nflfastr.com/" class="external-link">nflfastR:
Functions to efficiently access NFL play by play data</a></em>.
2024.</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nolan MacDonald.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
